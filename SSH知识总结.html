<!DOCTYPE html><html class="theme-next pisces use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet"><link href="/css/main.css?v=5.1.4" rel="stylesheet"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4"><link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222"><meta name="keywords" content="linux,computerNetwork,"><meta name="description" content="最近部署博客和远程访问云主机经常性用到SSH这个协议，还遇到了一些问题，好在通过查资料都解决了。在查询资料的过程中发现很多文章都有些错误或者太过简略。所以我打算写下这篇文章介绍下SSH这个协议以及一些相关用法。"><meta name="keywords" content="linux,computerNetwork"><meta property="og:type" content="article"><meta property="og:title" content="SSH知识总结"><meta property="og:url" content="http://www.lyreal666.com/SSH知识总结.html"><meta property="og:site_name" content="lyreal666&#39;s blog"><meta property="og:description" content="最近部署博客和远程访问云主机经常性用到SSH这个协议，还遇到了一些问题，好在通过查资料都解决了。在查询资料的过程中发现很多文章都有些错误或者太过简略。所以我打算写下这篇文章介绍下SSH这个协议以及一些相关用法。"><meta property="og:locale" content="zh-Hans"><meta property="og:image" content="http://www.lyreal666.com/SSH知识总结/encrypt.jpg"><meta property="og:image" content="http://www.lyreal666.com/SSH知识总结/exchangeKey.jpg"><meta property="og:image" content="http://www.lyreal666.com/SSH知识总结/ssh-pwd-login.jpg"><meta property="og:image" content="http://www.lyreal666.com/SSH知识总结/ssh-public-key-login.jpg"><meta property="og:image" content="http://www.lyreal666.com/SSH知识总结/github-add-sshkey.jpg"><meta property="og:updated_time" content="2018-10-22T04:46:50.311Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="SSH知识总结"><meta name="twitter:description" content="最近部署博客和远程访问云主机经常性用到SSH这个协议，还遇到了一些问题，好在通过查资料都解决了。在查询资料的过程中发现很多文章都有些错误或者太过简略。所以我打算写下这篇文章介绍下SSH这个协议以及一些相关用法。"><meta name="twitter:image" content="http://www.lyreal666.com/SSH知识总结/encrypt.jpg"><script id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://www.lyreal666.com/SSH知识总结.html"><title>SSH知识总结 | lyreal666's blog</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">lyreal666's blog</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">生命不息,折腾不止</p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-schedule"><a href="/schedule/" rel="section"><i class="menu-item-icon fa fa-fw fa-calendar"></i><br>日程表</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://www.lyreal666.com/SSH知识总结.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="yuTengJing"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="lyreal666's blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">SSH知识总结</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-20T13:51:00+08:00">2018-10-20</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术/" itemprop="url" rel="index"><span itemprop="name">技术</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><p>最近部署博客和远程访问云主机经常性用到SSH这个协议，还遇到了一些问题，好在通过查资料都解决了。在查询资料的过程中发现很多文章都有些<code>错误</code>或者太过<code>简略</code>。所以我打算写下这篇文章介绍下SSH这个协议以及一些相关用法。</p><a id="more"></a><h2 id="什么是SSH"><a href="#什么是SSH" class="headerlink" title="什么是SSH"></a>什么是SSH</h2><p>SSH是<strong>Secure Shell</strong>的缩写, 是一个是由客户端和服务器端组成的安全可靠的的应用层网络协议。</p><p>SSH协议传输层采用<code>TCP</code>建立连接，服务器默认端口号<code>22</code>。安全协议版本是SSH2。有两个不兼容的大版本<code>1.x</code>和<code>2.x</code>，<code>1.x</code>版本又分<code>1.3</code>和<code>1.5</code>两个版本。区别：</p><ol><li>SSH1没有对客户端的秘钥进行校验，很容易被植入恶意代码</li><li>SSH2增加了一个确认联机正确性的Diffe_Hellman机制，每次数据的传输，Server都会检查数据来源的正确性，避免黑客入侵。SSH2支持RSA和DSA密钥 ：<ul><li>DSA: digital signature Algorithm 数字签名</li><li>RSA: 既可以数字签名又可以加密</li></ul></li></ol><p>SSH最初是UNIX系统上的一个程序，现在几乎所有的操作系统都有SSH程序;。</p><p>常见的其它网络协议如ftp,pop,telnet,它们其实都是不安全的，因为它们传输的数据都是明文，如果遭到了中间人攻击，就可能造成严重损失。</p><p>什么是中间人攻击? 举个例子就明白了:</p><p>中间人冒充服务器接收到客户端发送的用户名和密码，即便是客户端通过hash加密，中间人无法获取真正的密码，但是服务器它认的只是你传输的数据,中间人可以直接把获取的用户名密码或者hash加密过的密码发送给服务器，从而伪装成客户对服务器发送数据。</p><p>SSH协议也能够防止DNS欺骗和IP欺骗。使用SSH，还有一个额外的好处就是传输的数据是经过压缩的，所以可以加快传输的速度。SSH有很多功能，它既可以代替telnet，又可以为ftp, pop甚至为ppp提供一个安全的”通道” 。</p><h2 id="SSH的方式加密"><a href="#SSH的方式加密" class="headerlink" title="SSH的方式加密"></a>SSH的方式加密</h2><p>要想看懂SSH的加密方式必须先懂几个概念: <code>对称加密</code>,<code>非对称加密</code>。这里简要介绍一下:</p><ol><li><p>对称加密: 加密和解密用同一把密钥的加密方式。就是大家最能想到的那种普通的加密方式, 用一个密码加密，同一个密码解密，这种加密方式的加密强度和密码的长度有关，密码越长越1mb长度的密码肯定比1bit密码强度高，常用来加密传输的数据,ssh协议中收发文件内容肯定采用的是对称加密。</p></li><li><p>非对称加密: 非对称加密指的是加密和解密用的不是一把钥匙的加密方式。一把叫私钥(privateKey)，不能公开，用来解密或签名。一把叫公钥(publicKey)，可以公开在网络上传输，用来加密或验证签名; 加密数据既可以用公钥也可以用私钥，但必须使用同一个算法下对应的私钥或公钥才能解密。它们总是成对的，一个加密，一个解密。由于私钥总是不公开的，所以非对称加密是很可靠的。但是解密速度比较慢，所以常用于交换信息，比如ssh中交换公钥，发送命令信息。</p><p>加密和签名是非对称加密的两个常见应用场景, 它们是有区别的:</p><ol><li><p>加密时:</p><p>公钥加密明文 =&gt; 密文。</p><p>私钥解密密文 =&gt; 明文。</p><p>加密是不能用私钥加密的，接收方并不知道用哪个公钥解密，你可能会说可以告诉接收方用哪个公钥解密，但是这样避免不了中间人攻击。一般是用接收方发送给发送方的的公钥加密，然后接收方接收后用私钥解密。</p></li><li><p>签名时:</p><p>私钥加密内容 =&gt; 签名。</p><p>公钥解密签名 =&gt; 解密得到的内容比对发送过来的内容。</p><p>签名是为了接收方确定接收内容来源是否可靠。如果采用用公钥加密私钥解密，因为公钥是公开的, 那所有获得公钥的人都可以冒充发送方发送数据给接收方。可靠的发送方用私钥加密, 接收方用保存的可信赖方的公钥解密，如果解密内容和接收内容一样，来源可靠，不可信赖来源发送的内容用我保存的可信赖方的公钥解密是和内容不一样的，从而确保接收的内容的来源是可靠的;</p></li></ol></li></ol><p>保证SSH安全性的方法，简单来说就是客户端和服务端各自生成一套私钥和公钥，并且互相交换公钥，这样每一条发出的数据都可以用对方的公钥来加密，对方收到后再用自己的私钥来解密。</p><p><img src="/SSH知识总结/encrypt.jpg" alt="SSH传输消息的加密方式"></p><h2 id="SSH连接创建过程"><a href="#SSH连接创建过程" class="headerlink" title="SSH连接创建过程"></a>SSH连接创建过程</h2><p>由上一张图可以看出来，两台机器除了各自的一套公、私钥之外，还保存了对方的公钥，因此必然存在一个交换各自公钥的步骤。实际上并不是简单的各自发送公钥，而是存在一些专门的算法。这一步在首次链接时、数据传送之前发生。</p><p><img src="/SSH知识总结/exchangeKey.jpg" alt="SSH连接创建"></p><h2 id="SSH的验证方式"><a href="#SSH的验证方式" class="headerlink" title="SSH的验证方式"></a>SSH的验证方式</h2><p>SSH协议的验证方式有两种， 都有用到<code>非对称加密</code>:</p><ol><li>用户名密码登入。 使用公钥对用户密码加密。</li><li>公钥认证。和数字签名原理一样，只不过用来验证的内容是服务器发送的随机字符串。</li></ol><h4 id="用户名密码登入"><a href="#用户名密码登入" class="headerlink" title="用户名密码登入"></a>用户名密码登入</h4><p><img src="/SSH知识总结/ssh-pwd-login.jpg" alt="用户名密码验证"></p><p>说明：</p><ol><li>服务端收到登录请求后，首先互换公钥，详细步骤如上一节所述。</li><li>客户端用服务端的公钥加密账号密码并发送</li><li>服务端用自己的秘钥解密后得到账号密码，然后进行验证</li><li>服务端用客户端的公钥加密验证结果并返回</li><li>客户端用自己的秘钥解密后得到验证结果 　　</li></ol><h4 id="公钥验证（解密"><a href="#公钥验证（解密" class="headerlink" title="公钥验证（解密)"></a>公钥验证（解密)</h4><p><img src="/SSH知识总结/ssh-public-key-login.jpg" alt="公钥验证">说明：</p><ol><li>客户端用户必须手动地将自己的公钥添加到服务器一个名叫authorized_keys的文件里，顾名思义，这个文件保存了所有可以远程登录的机器的公钥。</li><li>客户端发起登录请求，并且发送一个自己公钥的指纹（具有唯一性，但不是公钥）</li><li>服务端根据指纹检测此公钥是否保存在authorized_keys中</li><li>若存在，服务端便生成一段随机字符串，然后利用客户端公钥加密并返回</li><li>客户端收到后用自己的私钥解密，再利用服务端公钥加密后发回</li><li>服务端收到后用自己的私钥解密，如果为同一字符串，则验证通过 　　</li></ol><h2 id="SSH实际应用"><a href="#SSH实际应用" class="headerlink" title="SSH实际应用"></a>SSH实际应用</h2><p>实际应用中我们常用SSH来安全的进行远程控制，或者传输文件。github或coding等远程git仓库都可以选择使用SSH方式进行上传下载。</p><h3 id="远程控制"><a href="#远程控制" class="headerlink" title="远程控制"></a>远程控制</h3><p>使用ssh进行远程控制要求服务器一定要安装openssh-server或sshd。可以通过下面命令测试linux系统有没有安装ssh服务器:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service sshd status</span><br><span class="line"><span class="meta">#</span> 出现 Loader error(Reason: no such file or directory) 表示没安装</span><br><span class="line"><span class="meta">#</span> 出现 Active: inactive(dead) 表示安装了，但是没开启</span><br></pre></td></tr></table></figure><p>ssh服务是一个守护进程(demon)，系统后台监听客户端的连接，ssh服务端的进程名为sshd,负责实时监听客户端的请求(IP 22端口)，包括公共秘钥等交换等信息。</p><p>ssh服务端由2部分组成： openssh(提供ssh服务) openssl(提供加密的程序)</p><p>ssh的客户端可以用 XSHELL，Securecrt, Mobaxterm等工具进行连接。其实只要系统安装了SSH程序就可以通过系统终端访问。Windows上可以直接通过cmd或者powerShell使用，也可以用gitbash或者是cygwin等linux环境。</p><p>使用SSH建立远程连接的命令是:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh username@ip</span><br></pre></td></tr></table></figure><p>可以使用<code>-p</code>参数指定端口号。如果没有设置公钥访问一般会要求输入密码。每次登入都要输密码，这是个麻烦事，所以我们一般都会配置公钥访问。配置公钥访问主要分两步:</p><h4 id="第一步-生成密钥对"><a href="#第一步-生成密钥对" class="headerlink" title="第一步: 生成密钥对"></a>第一步: 生成密钥对</h4><p>进入<code>.ssh</code>文件夹,:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd ~/.ssh/</span><br></pre></td></tr></table></figure><p>这样的话使用<code>-f</code>参数指定私钥路径时不用加上<code>.ssh</code>文件夹路径了。</p><p>生成密钥对可以使用<code>ssh-keygen</code>这个程序指定各种参数生成你想要的密钥对,一般格式如下:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa  -b key_length -f identityFile -C youremail.com</span><br></pre></td></tr></table></figure><p>实例：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lyreal666@DESKTOP-FMIHTUE MINGW64 ~/Desktop</span><br><span class="line"><span class="meta">$</span> ssh-keygen -t rsa -b 4096 -f my_id_rsa -C "2713151718@qq.com"</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter passphrase (empty for no passphrase):</span><br></pre></td></tr></table></figure><ul><li><code>-t</code> 即type指定密钥算法</li><li><code>b</code> 即bit指定密钥长度，至少<code>768</code>位才是安全的，因为目前被破解的最长的RSA密钥长度就是768bit。 ssh-keygen默认就是2048bit位;</li><li><code>f</code>指定私钥文件，</li><li><code>-c</code> 即comment指定提示文字。</li></ul><p>然后后提示你输入加密密钥的密码。直接回车就是不需要密码，如果对安全性要求不是特别高那就别设置加密密钥的密码了，不然的话即使配置了ssh免密码登入还要输一次密钥加密密码。</p><p>输入密码两次后会在当前文件夹(如果没有指定路径的话)产生两个密钥文件。<code>.pub</code>结尾的就是生成的公钥文件。</p><h4 id="第二步-把公钥放到服务器上"><a href="#第二步-把公钥放到服务器上" class="headerlink" title="第二步: 把公钥放到服务器上"></a>第二步: 把公钥放到服务器上</h4><p>把公钥放到服务器上一般有两种方式:</p><ol><li><p>使用<code>ssh-copy-id</code>的程序:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id -i identityFile username@ip</span><br></pre></td></tr></table></figure><p>使用<code>-i</code>指定公钥文件路径，这个程序会执行一系列批处理命令将公钥文件内容追加到服务器的<code>~/.ssh/authorized_keys</code>文件末尾，使用这个命令时会要求输入密码，按要求操作即可， 操作成功后会提示你使用<code>ssh username@ip</code>的方式免密码登入。</p></li><li><p>第二种方式就很直接了，先用密码登入服务器，再把本地的公钥文件内容手动复制追加到服务器的<code>~/.ssh/authorized_keys</code>末尾</p></li></ol><p>注意事项:</p><ol><li><code>.pub</code>结尾的公钥文件一般是两行，第一行是很长的密码，第二行是一个空行，手动追加是要把第二行也一并复制过去。</li><li>第一种方式如果不指定<code>-i</code>参数，默认是拷贝<code>~/.ssh/id_rsa.pub</code></li><li>由于手动复制误操作的可能性较大，推荐用第一种方式</li></ol><p>通过上面两步，然后就可以使用<code>ssh username@ip</code>免密码直接登入了。</p><h3 id="Git远程托管平台如何配置免密码上传文件"><a href="#Git远程托管平台如何配置免密码上传文件" class="headerlink" title="Git远程托管平台如何配置免密码上传文件"></a>Git远程托管平台如何配置免密码上传文件</h3><p>作为一个开发者，<code>git</code>是必不可少代码管理工具，平时也少不了要和git仓库托管平台如<code>github</code>, <code>coding</code>, <code>gitee</code>, <code>gitlab</code>打交道。选择<code>http</code>协议是没办法配置免密码上传文件的, 但是一般这些平台都会提供<code>http</code>和<code>ssh</code>两种协议来进行文件传输。在这些平台使用ssh协议来传输文件的第一件事就是配置SSH密钥。具体做法和上面的很类似。</p><ol><li><p>在本地生成密钥, 和生成密钥方式上面的一模一样。</p></li><li><p>拷贝密钥到托管平台，一般在托管平台的设置中找找就能找到添加SSH密钥的地方。</p><p><img src="/SSH知识总结/github-add-sshkey.jpg" alt="github添加publicKey"></p></li><li><p>使用<code>ssh -T git@hostname</code>命令测试连接是否成功比如:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">lyreal666@DESKTOP-FMIHTUE MINGW64 ~/.ssh</span><br><span class="line"><span class="meta">$</span> ssh -T gitss@github.com</span><br><span class="line">gitss@github.com: Permission denied (publickey).</span><br><span class="line"></span><br><span class="line">lyreal666@DESKTOP-FMIHTUE MINGW64 ~/.ssh</span><br><span class="line"><span class="meta">$</span> ssh -T git@github.com</span><br><span class="line">Hi tjx666! You've successfully authenticated, but GitHub does not provide shell access.</span><br><span class="line"></span><br><span class="line">lyreal666@DESKTOP-FMIHTUE MINGW64 ~/.ssh</span><br><span class="line"><span class="meta">$</span> ssh -T git@git.coding.net</span><br><span class="line">Coding 提示: Hello tjx666, You've connected to Coding.net via SSH. This is a personal key.</span><br><span class="line">tjx666，你好，你已经通过 SSH 协议认证 Coding.net 服务，这是一个个人公钥</span><br><span class="line"></span><br><span class="line">lyreal666@DESKTOP-FMIHTUE MINGW64 ~/.ssh</span><br><span class="line"><span class="meta">$</span> ssh -T -v gitss@github.com</span><br><span class="line">OpenSSH_7.7p1, OpenSSL 1.0.2o  27 Mar 2018</span><br><span class="line">debug1: Reading configuration data /etc/ssh/ssh_config</span><br><span class="line">debug1: Connecting to github.com [192.30.253.113] port 22.</span><br><span class="line">debug1: Connection established.</span><br><span class="line">debug1: identity file /c/Users/lyreal666/.ssh/id_rsa type 0</span><br><span class="line">debug1: key_load_public: No such file or directory</span><br></pre></td></tr></table></figure></li></ol><p>PS: 我们可以使用<code>-v</code>参数查看整个<code>ssh</code>认证过程查看认证不成功的原因在哪;</p><h3 id="ssh-add"><a href="#ssh-add" class="headerlink" title="ssh-add"></a>ssh-add</h3><p><code>ssh-agent</code>用于管理 ssh private keys，目的是对解密的私钥进行高速缓存。</p><p>配置了多套密钥，再测试和服务器的连通性的时候，查看测试结果发现ssh程序每次使用的私钥都是默认的那把,根本不会使用新添加的私钥和服务器做认证，那是因为默认情况下用来和服务器进行认证的密钥是<code>~/.ssh/id_rsa</code>这个文件，当你添加新的一对密钥时，需要手动将私钥添加进<code>ssh-agent</code>,<code>ssh-add</code>这个命令就是添加私钥到<code>ssh-agent</code>的，这样，在多套密钥的情况下就会使用<code>ssh-agent</code>维护列表中的私钥去和对应的服务器做认证。</p><p>ssh-add 提示并将用户使用的私钥添加到 ssh-agent 维护列表中，此后当公钥连接到远程 SSH 或 SCP 主机时，不再提示信息。</p><ol><li>启动</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval $(ssh-agent) &gt; /dev/null</span><br></pre></td></tr></table></figure><ol start="2"><li>把专有密钥添加到 ssh-agent 中</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-add ~./ssh/id_dsa1</span><br></pre></td></tr></table></figure><ol start="3"><li>从 ssh-agent 中删除密钥</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-add -d ./ssh/id_xxx.pub1</span><br></pre></td></tr></table></figure><ol start="4"><li>查看 ssh-agent 中的密钥</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-add -l</span><br></pre></td></tr></table></figure><h3 id="聊聊-ssh-文件夹"><a href="#聊聊-ssh-文件夹" class="headerlink" title="聊聊~/.ssh/文件夹"></a>聊聊~/.ssh/文件夹</h3><p>​ 下面是客户端文件夹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">lyreal666@DESKTOP-FMIHTUE MINGW64 ~/Desktop</span><br><span class="line"><span class="meta">$</span> cd ~/.ssh</span><br><span class="line">lyreal666@DESKTOP-FMIHTUE MINGW64 ~/.ssh</span><br><span class="line"><span class="meta">$</span> ls -lah</span><br><span class="line">total 58K</span><br><span class="line">drwxr-xr-x 1 lyreal666 197609    0 10月 18 20:49 ./</span><br><span class="line">drwxr-xr-x 1 lyreal666 197609    0 10月 18 22:13 ../</span><br><span class="line">-rw-r--r-- 1 lyreal666 197609 3.2K 10月 18 19:26 coding_id_rsa</span><br><span class="line">-rw-r--r-- 1 lyreal666 197609  743 10月 18 19:26 coding_id_rsa.pub</span><br><span class="line">-rw-r--r-- 1 lyreal666 197609 1.7K 9月  12 10:47 id_rsa</span><br><span class="line">-rw-r--r-- 1 lyreal666 197609  399 9月  12 10:47 id_rsa.pub</span><br><span class="line">-rw-r--r-- 1 lyreal666 197609 1.8K 10月 18 21:51 known_hosts</span><br><span class="line">-rw-r--r-- 1 lyreal666 197609  399 10月 18 20:24 config</span><br><span class="line">-rw-r--r-- 1 lyreal666 197609 3.2K 10月 18 19:22 tencent_id_rsa</span><br><span class="line">-rw-r--r-- 1 lyreal666 197609  743 10月 18 19:22 tencent_id_rsa.pub</span><br></pre></td></tr></table></figure><p>SSH程序的各种数据都存放在在用户家目录下面的.ssh文件夹，windows平台的话一般存放在C:\Users\username.ssh。<code>id_rsa</code>结尾的文件表示这是一个是私钥文文件，当然私钥文件可以取任意名字，不过我觉得还是以id_rsa结尾好。以<code>.pub</code>结尾是公钥文件，一个私钥对应的公钥文件一般是其文件名加<code>.pub</code>因为生成公钥时是没法指定文件名的。</p><p><code>known_hosts</code>文件记录了你访问过的服务器的域名或ip以及密钥信息。下次访问就不会出现像下面的警告，如果第一次访问服务器, 可能会出现像下面这样警告:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ssh root@121.43.166.172</span><br><span class="line">The authenticity of host '121.43.166.172 (121.43.166.172)' can't be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:oeo2WeQieRUkyokOF6MIoGcx31GtWRwB7p7dHxqg17s.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">Warning: Permanently added '121.43.166.172' (ECDSA) to the list of known hosts.</span><br><span class="line">root@121.43.166.172's password:</span><br></pre></td></tr></table></figure><p>直接输入yes继续操作，删掉没有关系，只不过下次访问时就和第一次访问一样会有上面的警告。</p><p><code>config</code>文件是SSH的配置文件,使用config文件可以更方便更精确的配置SSH程序怎样访问某个服务器,下面给出一个示例:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">Host</span> <span class="string">coding</span></span><br><span class="line">    <span class="string">HostName</span> <span class="string">git.coding.net</span></span><br><span class="line">    <span class="string">User</span> <span class="string">lyreal666</span></span><br><span class="line">    <span class="string">IdentityFile</span> <span class="string">~/.ssh/coding_id_rsa</span></span><br><span class="line"></span><br><span class="line"><span class="string">Host</span> <span class="string">github</span></span><br><span class="line">    <span class="string">HostName</span> <span class="string">github.com</span></span><br><span class="line">    <span class="string">User</span> <span class="string">tjx666</span></span><br><span class="line">    <span class="string">IdentityFile</span> <span class="string">~/.ssh/id_rsa</span></span><br><span class="line"></span><br><span class="line"><span class="string">Host</span> <span class="string">aubt</span></span><br><span class="line">    <span class="string">HostName</span> <span class="number">121.43</span><span class="number">.255</span><span class="number">.172</span></span><br><span class="line">    <span class="string">User</span> <span class="string">root</span></span><br><span class="line">    <span class="string">IdentityFile</span> <span class="string">~/.ssh/aliyun-ubuntu_id_rsa</span></span><br><span class="line"></span><br><span class="line"><span class="string">Host</span> <span class="string">tencent</span></span><br><span class="line">    <span class="string">HostName</span>  <span class="string">git.dev.tencent.com</span></span><br><span class="line">    <span class="string">User</span> <span class="string">tjx666</span></span><br><span class="line">    <span class="string">IdentityFile</span> <span class="string">~/.ssh/tencent_id_rsa</span></span><br></pre></td></tr></table></figure><p>解释一下配置参数:</p><ul><li><p>Host: 可以随便取，相当于你对某个服务器的配置取一个名字,比如下次你想登入上面的ip为121.43.255.172的云主机，可以直接使用下面的命令:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh aubt</span><br></pre></td></tr></table></figure></li><li><p>HostName: 表示你访问的服务器的域名或ip;</p></li><li><p>User: 你访问使用的用户名</p></li><li><p>IdentityFile: 你访问服务器使用的私钥文件路径</p></li></ul><p>可以看到使用<code>cnofig</code>文件管理多套密钥很方便，SSH这个程序还是很人性化的。如果配置格式有误，使用SSH程序时会报错。</p></div><div><div><div style="text-align:left;color:#666;font-size:14px">(完)</div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/linux/" rel="tag"># linux</a> <a href="/tags/computerNetwork/" rel="tag"># computerNetwork</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/推荐一波chrome插件.html" rel="next" title="推荐一波chrome插件"><i class="fa fa-chevron-left"></i> 推荐一波chrome插件</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/银行家算法-BankerAlgorithm.html" rel="prev" title="银行家算法(BankerAlgorithm)">银行家算法(BankerAlgorithm)<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><section class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="yuTengJing"><p class="site-author-name" itemprop="name">yuTengJing</p><p class="site-description motion-element" itemprop="description">爱好编程的大三dog</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">7</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">4</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">7</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="2713151713@qq.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i> E-Mail</a></span></div></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#什么是SSH"><span class="nav-number">1.</span> <span class="nav-text">什么是SSH</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SSH的方式加密"><span class="nav-number">2.</span> <span class="nav-text">SSH的方式加密</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SSH连接创建过程"><span class="nav-number">3.</span> <span class="nav-text">SSH连接创建过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SSH的验证方式"><span class="nav-number">4.</span> <span class="nav-text">SSH的验证方式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#用户名密码登入"><span class="nav-number">4.0.1.</span> <span class="nav-text">用户名密码登入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#公钥验证（解密"><span class="nav-number">4.0.2.</span> <span class="nav-text">公钥验证（解密)</span></a></li></ol></li></ol><li class="nav-item nav-level-2"><a class="nav-link" href="#SSH实际应用"><span class="nav-number">5.</span> <span class="nav-text">SSH实际应用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#远程控制"><span class="nav-number">5.1.</span> <span class="nav-text">远程控制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#第一步-生成密钥对"><span class="nav-number">5.1.1.</span> <span class="nav-text">第一步: 生成密钥对</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#第二步-把公钥放到服务器上"><span class="nav-number">5.1.2.</span> <span class="nav-text">第二步: 把公钥放到服务器上</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Git远程托管平台如何配置免密码上传文件"><span class="nav-number">5.2.</span> <span class="nav-text">Git远程托管平台如何配置免密码上传文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ssh-add"><span class="nav-number">5.3.</span> <span class="nav-text">ssh-add</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#聊聊-ssh-文件夹"><span class="nav-number">5.4.</span> <span class="nav-text">聊聊~/.ssh/文件夹</span></a></li></ol></li></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2018</span><span class="with-love"><i class="fa fa-user"></i></span> <span class="author" itemprop="copyrightHolder">yuTengJing</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script src="/lib/jquery/index.js?v=2.1.3"></script><script src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script src="/js/src/utils.js?v=5.1.4"></script><script src="/js/src/motion.js?v=5.1.4"></script><script src="/js/src/affix.js?v=5.1.4"></script><script src="/js/src/schemes/pisces.js?v=5.1.4"></script><script src="/js/src/scrollspy.js?v=5.1.4"></script><script src="/js/src/post-details.js?v=5.1.4"></script><script src="/js/src/bootstrap.js?v=5.1.4"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script></body></html>